<!DOCTYPE html>

<html>
<head>
  <title>linkLabelsView.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="admin.html">
                admin.coffee
              </a>
            
              
              <a class="source" href="api.auditData.html">
                api.auditData.coffee
              </a>
            
              
              <a class="source" href="api.auditEvent.html">
                api.auditEvent.coffee
              </a>
            
              
              <a class="source" href="api.html">
                api.coffee
              </a>
            
              
              <a class="source" href="api.entity.html">
                api.entity.coffee
              </a>
            
              
              <a class="source" href="api.map.html">
                api.map.coffee
              </a>
            
              
              <a class="source" href="api.server.html">
                api.server.coffee
              </a>
            
              
              <a class="source" href="api.variable.html">
                api.variable.coffee
              </a>
            
              
              <a class="source" href="api.view.html">
                api.view.coffee
              </a>
            
              
              <a class="source" href="app.html">
                app.coffee
              </a>
            
              
              <a class="source" href="app.instance.html">
                app.instance.coffee
              </a>
            
              
              <a class="source" href="data.html">
                data.coffee
              </a>
            
              
              <a class="source" href="dataUtil.html">
                dataUtil.coffee
              </a>
            
              
              <a class="source" href="messages.html">
                messages.coffee
              </a>
            
              
              <a class="source" href="auditData.html">
                auditData.coffee
              </a>
            
              
              <a class="source" href="auditEvent.html">
                auditEvent.coffee
              </a>
            
              
              <a class="source" href="base.html">
                base.coffee
              </a>
            
              
              <a class="source" href="entityDefinition.html">
                entityDefinition.coffee
              </a>
            
              
              <a class="source" href="entityObject.html">
                entityObject.coffee
              </a>
            
              
              <a class="source" href="eventAction.html">
                eventAction.coffee
              </a>
            
              
              <a class="source" href="eventRule.html">
                eventRule.coffee
              </a>
            
              
              <a class="source" href="link.html">
                link.coffee
              </a>
            
              
              <a class="source" href="map.html">
                map.coffee
              </a>
            
              
              <a class="source" href="shape.html">
                shape.coffee
              </a>
            
              
              <a class="source" href="user.html">
                user.coffee
              </a>
            
              
              <a class="source" href="userSettings.html">
                userSettings.coffee
              </a>
            
              
              <a class="source" href="variable.html">
                variable.coffee
              </a>
            
              
              <a class="source" href="routes.html">
                routes.coffee
              </a>
            
              
              <a class="source" href="settings.html">
                settings.coffee
              </a>
            
              
              <a class="source" href="sockets.html">
                sockets.coffee
              </a>
            
              
              <a class="source" href="tutorial.html">
                tutorial.coffee
              </a>
            
              
              <a class="source" href="vectors.html">
                vectors.coffee
              </a>
            
              
              <a class="source" href="adminView.html">
                adminView.coffee
              </a>
            
              
              <a class="source" href="alertView.html">
                alertView.coffee
              </a>
            
              
              <a class="source" href="auditDataManagerView.html">
                auditDataManagerView.coffee
              </a>
            
              
              <a class="source" href="auditEventManagerView.html">
                auditEventManagerView.coffee
              </a>
            
              
              <a class="source" href="baseView.html">
                baseView.coffee
              </a>
            
              
              <a class="source" href="createMapView.html">
                createMapView.coffee
              </a>
            
              
              <a class="source" href="entityManagerView.html">
                entityManagerView.coffee
              </a>
            
              
              <a class="source" href="footerView.html">
                footerView.coffee
              </a>
            
              
              <a class="source" href="helpView.html">
                helpView.coffee
              </a>
            
              
              <a class="source" href="entitiesTabView.html">
                entitiesTabView.coffee
              </a>
            
              
              <a class="source" href="inspectorTabView.html">
                inspectorTabView.coffee
              </a>
            
              
              <a class="source" href="mapTabView.html">
                mapTabView.coffee
              </a>
            
              
              <a class="source" href="shapeTabView.html">
                shapeTabView.coffee
              </a>
            
              
              <a class="source" href="controlsView.html">
                controlsView.coffee
              </a>
            
              
              <a class="source" href="labelEditView.html">
                labelEditView.coffee
              </a>
            
              
              <a class="source" href="linkCreatorView.html">
                linkCreatorView.coffee
              </a>
            
              
              <a class="source" href="linkLabelsView.html">
                linkLabelsView.coffee
              </a>
            
              
              <a class="source" href="linkView.html">
                linkView.coffee
              </a>
            
              
              <a class="source" href="shapeLabelsView.html">
                shapeLabelsView.coffee
              </a>
            
              
              <a class="source" href="shapeView.html">
                shapeView.coffee
              </a>
            
              
              <a class="source" href="shapesMoverView.html">
                shapesMoverView.coffee
              </a>
            
              
              <a class="source" href="mapView.html">
                mapView.coffee
              </a>
            
              
              <a class="source" href="menuView.html">
                menuView.coffee
              </a>
            
              
              <a class="source" href="overlayView.html">
                overlayView.coffee
              </a>
            
              
              <a class="source" href="scriptEditorView.html">
                scriptEditorView.coffee
              </a>
            
              
              <a class="source" href="selfTestView.html">
                selfTestView.coffee
              </a>
            
              
              <a class="source" href="settingsView.html">
                settingsView.coffee
              </a>
            
              
              <a class="source" href="startView.html">
                startView.coffee
              </a>
            
              
              <a class="source" href="variableManagerView.html">
                variableManagerView.coffee
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>linkLabelsView.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2>LINK LABELS VIEW</h2>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Represents all editable / dynamic labels available on a <a href="linkView.html">Link View</a>.
Each link can have only one MapLinkLabelsView, but each MapLinkLabelsView can have up
to 3 editable labels (start, middle, end).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="class"><span class="keyword">class</span> <span class="title">SystemApp</span>.<span class="title">MapLinkLabelsView</span> <span class="keyword">extends</span> <span class="title">SystemApp</span>.<span class="title">BaseView</span></span>

    currentEditingPosition: <span class="literal">null</span>        <span class="comment"># holds the position which is being currently edited (Start, Center. End)</span>
    labelEditView: <span class="literal">null</span>                 <span class="comment"># holds a [Label Edit View](labelEditView.html), used to change label values</span>
    svgStart: <span class="literal">null</span>                      <span class="comment"># the label on the start of the link path</span>
    svgMiddle: <span class="literal">null</span>                     <span class="comment"># the label on the middle of the link path</span>
    svgEnd: <span class="literal">null</span>                        <span class="comment"># the label on the end of the link path</span>
    svgIconStart: <span class="literal">null</span>                  <span class="comment"># the icon (used if text is empty) on the start of the link path</span>
    svgIconMiddle: <span class="literal">null</span>                 <span class="comment"># the icon (used if text is empty) on the middle of the link path</span>
    svgIconEnd: <span class="literal">null</span>                    <span class="comment"># the icon (used if text is empty) on the end of the link path</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2>INIT AND DISPOSE</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Init the label edit view and set its parent view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    initialize: =&gt;
        <span class="property">@baseInit</span>()
        <span class="property">@setEvents</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Base dispose for links labels.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    dispose: =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Remove all labels and icons from the DOM.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="property">@svgStart</span>?.remove()
        <span class="property">@svgMiddle</span>?.remove()
        <span class="property">@svgEnd</span>?.remove()
        <span class="property">@svgIconStart</span>?.remove()
        <span class="property">@svgIconMiddle</span>?.remove()
        <span class="property">@svgIconEnd</span>?.remove()</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Force delete the link view&#39;s properties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="property">@svgStart</span> = <span class="literal">null</span>
        <span class="property">@svgMiddle</span> = <span class="literal">null</span>
        <span class="property">@svgEnd</span> = <span class="literal">null</span>
        <span class="property">@svgIconStart</span> = <span class="literal">null</span>
        <span class="property">@svgIconMiddle</span> = <span class="literal">null</span>
        <span class="property">@svgIconEnd</span> = <span class="literal">null</span>
        <span class="property">@labelEditView</span> = <span class="literal">null</span>

        <span class="property">@baseDispose</span>()</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Bind event listeners to the view.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setEvents: =&gt;
        <span class="property">@listenTo</span> SystemApp.mapEvents, <span class="string">"edit:toggle"</span>, <span class="property">@toggleEdit</span>
        <span class="property">@listenTo</span> SystemApp.mapEvents, <span class="string">"zoom:in"</span>, <span class="property">@onZoom</span>
        <span class="property">@listenTo</span> SystemApp.mapEvents, <span class="string">"zoom:out"</span>, <span class="property">@onZoom</span>

        <span class="property">@listenTo</span> <span class="property">@model</span>, <span class="string">"change:foreground"</span>, <span class="property">@setAllForeground</span>
        <span class="property">@listenTo</span> <span class="property">@model</span>, <span class="string">"change:fontSize"</span>, <span class="property">@setAllFontSizes</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <h2>HELPER PROPERTIES</h2>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Return an array with all the SVG elements (labels and icons).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    svgs: =&gt;
        <span class="keyword">return</span> [<span class="property">@svgStart</span>, <span class="property">@svgMiddle</span>, <span class="property">@svgEnd</span>, <span class="property">@svgIconStart</span>, <span class="property">@svgIconMiddle</span>, <span class="property">@svgIconEnd</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Return an array with label SVG elements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    svgsLabels: =&gt;
        <span class="keyword">return</span> [<span class="property">@svgStart</span>, <span class="property">@svgMiddle</span>, <span class="property">@svgEnd</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Return an array with icon SVG elements.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    svgsIcons: =&gt;
        <span class="keyword">return</span> [<span class="property">@svgIconStart</span>, <span class="property">@svgIconMiddle</span>, <span class="property">@svgIconEnd</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2>RENDER AND POSITIONING</h2>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Render all label SVG elements on the map.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    render: (parent, position) =&gt;
        <span class="keyword">if</span> parent?
            <span class="property">@parentView</span> = parent

        <span class="keyword">if</span> <span class="keyword">not</span> position? <span class="keyword">or</span> position <span class="keyword">is</span> <span class="string">"Start"</span>
            left = <span class="property">@renderLabel</span> <span class="property">@model</span>.textStart(), <span class="property">@svgStart</span>, <span class="property">@svgIconStart</span>, <span class="string">"Start"</span>
            <span class="property">@svgStart</span> = left[<span class="number">0</span>]
            <span class="property">@svgIconStart</span> = left[<span class="number">1</span>]

        <span class="keyword">if</span> <span class="keyword">not</span> position? <span class="keyword">or</span> position <span class="keyword">is</span> <span class="string">"Middle"</span>
            center = <span class="property">@renderLabel</span> <span class="property">@model</span>.textMiddle(), <span class="property">@svgMiddle</span>, <span class="property">@svgIconMiddle</span>, <span class="string">"Middle"</span>
            <span class="property">@svgMiddle</span> = center[<span class="number">0</span>]
            <span class="property">@svgIconMiddle</span> = center[<span class="number">1</span>]

        <span class="keyword">if</span> <span class="keyword">not</span> position? <span class="keyword">or</span> position <span class="keyword">is</span> <span class="string">"End"</span>
            top = <span class="property">@renderLabel</span> <span class="property">@model</span>.textEnd(), <span class="property">@svgEnd</span>, <span class="property">@svgIconEnd</span>, <span class="string">"End"</span>
            <span class="property">@svgEnd</span> = top[<span class="number">0</span>]
            <span class="property">@svgIconEnd</span> = top[<span class="number">1</span>]

        <span class="property">@toggleEdit</span> <span class="property">@parentView</span>.parentView.editEnabled

        <span class="property">@setPosition</span>()
        <span class="property">@onZoom</span>()

        <span class="keyword">return</span> <span class="keyword">this</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Render a single label, passing a value, the target label SVG, and the overlay SVG
in case the value is empty. The position tells the location of the label related
to its parent <a href="linkView.html">Link View</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    renderLabel: (value, svg, iconSvg, position) =&gt;
        x = <span class="number">0</span>
        y = <span class="number">0</span>
        text = value
        iconSize = SystemApp.Settings.Map.icoActionsSize</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>If label has an <a href="auditData.html">AuditData</a> value bound or if it&#39;s an evaluation,
then show &quot;...&quot; before binding the values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        text = SystemApp.Settings.AuditData.loadingText <span class="keyword">if</span> SystemApp.DataUtil.hasDataBindingValue value

        <span class="keyword">if</span> svg?</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>If there&#39;s a label present already, copy its current position and text
before recreating it on a new label.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            x = svg.attr <span class="string">"x"</span>
            y = svg.attr <span class="string">"y"</span>
            text = svg.attr <span class="string">"text"</span>

            svg.unclick()
            svg.removeData()
            svg.remove()
            svg = <span class="literal">null</span>

        <span class="keyword">if</span> iconSvg?</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>If there&#39;s an icon present already, copy its current position
before recreating it on a new icon.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            x = iconSvg.attr <span class="string">"x"</span>
            y = iconSvg.attr <span class="string">"y"</span>

            iconSvg.unclick()
            iconSvg.unmouseover()
            iconSvg.unmouseout()
            iconSvg.removeData()
            iconSvg.remove()
            iconSvg = <span class="literal">null</span>

        <span class="keyword">if</span> value? <span class="keyword">and</span> value <span class="keyword">isnt</span> <span class="string">""</span>

            svg = <span class="property">@parentView</span>.parentView.paper.text <span class="number">0</span>, <span class="number">0</span>, text
            svg.attr {<span class="string">"x"</span>: x, <span class="string">"y"</span>: y, <span class="string">"fill"</span>: <span class="property">@parentView</span>.model.foreground(), <span class="string">"font-size"</span>: <span class="property">@parentView</span>.model.fontSize()}
            svg.attr {<span class="string">"cursor"</span>: <span class="string">"pointer"</span>, <span class="string">"text-anchor"</span>: <span class="string">"middle"</span>}
            svg.click <span class="property">@click</span>

            $(svg.node).data <span class="string">"labelPosition"</span>, position

        <span class="keyword">else</span>

            iconSvg = <span class="property">@parentView</span>.parentView.paper.image SystemApp.Settings.Map.icoAddLabelUrl, <span class="number">0</span>, <span class="number">0</span>, iconSize, iconSize
            iconSvg.attr {<span class="string">"x"</span>: x, <span class="string">"y"</span>: y, cursor: <span class="string">"pointer"</span>, opacity: SystemApp.Settings.Map.icoActionsOpacity}
            iconSvg.click <span class="property">@click</span>
            iconSvg.mouseover <span class="property">@iconMouseOver</span>
            iconSvg.mouseout <span class="property">@iconMouseOut</span>

            $(iconSvg.node).data <span class="string">"labelPosition"</span>, position

        <span class="keyword">return</span> [svg, iconSvg]</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Show the link labels and icons.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    show: =&gt;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Set opacity 1 on all labels.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        opacity = {<span class="string">"opacity"</span>: <span class="number">1</span>}
        svgs = <span class="property">@svgsLabels</span>()
        s?.animate(opacity, SystemApp.Settings.Map.blinkInterval) <span class="keyword">for</span> s <span class="keyword">in</span> svgs</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Set the opacity defined on the <a href="settings.html">Settings</a>, on all add label icons.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        opacity = {<span class="string">"opacity"</span>: SystemApp.Settings.Map.icoActionsOpacity}
        svgs = <span class="property">@svgsIcons</span>()
        s?.animate(opacity, SystemApp.Settings.Map.blinkInterval) <span class="keyword">for</span> s <span class="keyword">in</span> svgs</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Hide the link labels and icons.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    hide: =&gt;
        <span class="property">@currentEditingPosition</span> = <span class="literal">null</span>

        opacity = {<span class="string">"opacity"</span>: <span class="number">0</span>}
        svgs = <span class="property">@svgs</span>()
        s?.animate(opacity, SystemApp.Settings.Map.blinkInterval) <span class="keyword">for</span> s <span class="keyword">in</span> svgs</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Hide only the icons (where no label text has been defined).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    hideIcons: =&gt;
        opacity = {<span class="string">"opacity"</span>: <span class="number">0</span>}
        svgs = <span class="property">@svgsIcons</span>()
        s?.animate(opacity, SystemApp.Settings.Map.blinkInterval) <span class="keyword">for</span> s <span class="keyword">in</span> svgs</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Set the label positions on the map. Please note that if the parent link
is not visible then this method will stop immediately.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setPosition: =&gt;
        iconSize = SystemApp.Settings.Map.icoActionsSize
        iconHalfSize = iconSize / <span class="number">2</span>

        path = <span class="property">@parentView</span>.svg.svgLine
        lineLength = path.getTotalLength()</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>We need to check if line is long enough! Otherwise add the start and
end icons on the very start and very end of the line, without adding the padding
of 1.5 times the iconSize.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">if</span> lineLength &gt; iconSize * <span class="number">2</span>
            startPos = path.getPointAtLength(iconSize + iconHalfSize)
            endPos = path.getPointAtLength(lineLength - iconSize - iconHalfSize)
        <span class="keyword">else</span>
            startPos = path.getPointAtLength(iconHalfSize)
            endPos = path.getPointAtLength(lineLength - iconHalfSize)

        middlePos = path.getPointAtLength(lineLength / <span class="number">2</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Set label positions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="property">@svgStart</span>?.attr startPos
        <span class="property">@svgMiddle</span>?.attr middlePos
        <span class="property">@svgEnd</span>?.attr endPos</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Recalculate the horizontal and vertical alignments for icons, as the X is related
their left offset and not their center point, and Y is their top offset and
not their middle.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        startPos.x -= iconHalfSize
        startPos.y -= iconHalfSize
        middlePos.x -= iconHalfSize
        middlePos.y -= iconHalfSize
        endPos.x -= iconHalfSize
        endPos.y -= iconHalfSize</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Set icon positions.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="property">@svgIconStart</span>?.attr startPos
        <span class="property">@svgIconMiddle</span>?.attr middlePos
        <span class="property">@svgIconEnd</span>?.attr endPos</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Bring the labels to the front of the map. Usually called after changing
the selected link on the current <a href="mapView.html">Map View</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toFront: =&gt;
        svgs = <span class="property">@svgs</span>()
        s?.toFront() <span class="keyword">for</span> s <span class="keyword">in</span> svgs</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Bring the labels to the back of the current <a href="mapView.html">Map View</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toBack: =&gt;
        svgs = <span class="property">@svgs</span>()
        s?.toBack() <span class="keyword">for</span> s <span class="keyword">in</span> svgs</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>When user hovers the mouse over an &quot;add label&quot; icon, set its opacity to 1,
unless the <code>isCreatingLink</code> property of the <a href="mapView.html">Map View</a> is true.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    iconMouseOver: -&gt;
        <span class="keyword">return</span> <span class="keyword">if</span> SystemApp.mapView.isCreatingLink
        <span class="property">@attr</span> {<span class="string">"opacity"</span>: <span class="number">1</span>}</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>When mouse leaves an &quot;add label&quot; icon, set its opacity to the value set on the <a href="settings.html">Settings</a>,
unless the <code>isCreatingLink</code> property of the <a href="mapView.html">Map View</a> is true.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    iconMouseOut: -&gt;
        <span class="keyword">return</span> <span class="keyword">if</span> SystemApp.mapView.isCreatingLink
        <span class="property">@attr</span> {<span class="string">"opacity"</span>: SystemApp.Settings.Map.icoActionsOpacity}</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>When user put map on &quot;Edit Mode&quot;, show the label icons. If in locked mode, hide them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    toggleEdit: (enabled) =&gt;
        svgs = <span class="property">@svgsIcons</span>()

        <span class="keyword">if</span> enabled
            svg?.show() <span class="keyword">for</span> svg <span class="keyword">in</span> svgs
        <span class="keyword">else</span>
            svg?.hide() <span class="keyword">for</span> svg <span class="keyword">in</span> svgs</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h2>LABEL DATA BINDING</h2>

            </div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Set the value of the specified label.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setLabelValue: (svg, value) =&gt;
        <span class="keyword">if</span> <span class="keyword">not</span> svg? <span class="keyword">or</span> <span class="keyword">not</span> value?
            <span class="keyword">return</span>

        svg.attr {<span class="string">"text"</span>: value}</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Binds values from <a href="auditData.html">Audit Data items</a> to
the related link labels.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    bindAllLabelsData: =&gt;
        <span class="property">@bindLabelData</span> <span class="property">@svgStart</span>, <span class="property">@model</span>.textStart()
        <span class="property">@bindLabelData</span> <span class="property">@svgMiddle</span>, <span class="property">@model</span>.textMiddle()
        <span class="property">@bindLabelData</span> <span class="property">@svgEnd</span>, <span class="property">@model</span>.textEnd()</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Get the binding value which can come from an <a href="auditData.html">AuditData</a> or
a <a href="variable.html">Variable</a> and set it to the specified label.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    bindLabelData: (svg, value) =&gt;
        <span class="keyword">if</span> <span class="keyword">not</span> svg?
            <span class="keyword">return</span>

        newValue = SystemApp.DataUtil.getDataBindingValue value
        <span class="property">@setLabelValue</span> svg, newValue</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h2>LABEL EDIT</h2>

            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>When user clicks a label, check if the &quot;Delete&quot; key modifier is being pressed and
proceed with removing the label, or show the textbox for edition (call <code>showEditLabel</code>).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    click: (e) =&gt;
        src = $ e.target
        data = src.data <span class="string">"labelPosition"</span>

        <span class="keyword">if</span> <span class="keyword">not</span> data? <span class="keyword">or</span> data <span class="keyword">is</span> <span class="string">""</span>
            src = src.parent()
            data = src.data <span class="string">"labelPosition"</span>

        <span class="property">@currentEditingPosition</span> = data</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Set the current selected element on the <a href="mapView.html">Map View</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="property">@parentView</span>.parentView.setCurrentElement <span class="property">@parentView</span>

        <span class="keyword">if</span> <span class="property">@parentView</span>.parentView.editEnabled
            <span class="keyword">if</span> <span class="property">@isEventDelete</span> e
                <span class="property">@parentView</span>.blinkAndRemove()
            <span class="keyword">else</span>
                <span class="property">@showEditLabel</span> e

        e.preventDefault()
        e.stopPropagation()</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Start editing one of the link labels. This will create a temporary textbox on the map where
the user can edit or bind values from an <a href="auditData.html">AuditData</a> to the label text.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    showEditLabel: (e) =&gt;
        <span class="keyword">if</span> <span class="keyword">not</span> <span class="property">@labelEditView</span>?
            <span class="property">@labelEditView</span> = <span class="keyword">new</span> SystemApp.MapLabelEditView()
            <span class="property">@labelEditView</span>.render <span class="keyword">this</span>
            <span class="property">@labelEditView</span>.<span class="literal">on</span> <span class="string">"save"</span>, <span class="property">@saveEditLabel</span>

        src = e.target
        src = src.parentElement <span class="keyword">if</span> <span class="keyword">not</span> src.getBBox?
        pos = src.getBBox()</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Make sure text is never undefined or null!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        text = <span class="property">@model</span>.get <span class="string">"text<span class="subst">#{@currentEditingPosition}</span>"</span>
        text = <span class="string">""</span> <span class="keyword">if</span> <span class="keyword">not</span> text?</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>We need to remove half the width and height to properly get the center values (and not the offset).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="property">@labelEditView</span>.show text, pos.x + pos.width / <span class="number">2</span>, pos.y + pos.height</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Save the edited value of the <a href="labelEditView.html">Label Edit View</a> to the
<code>text</code> property of the model.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    saveEditLabel: (view, value) =&gt;
        <span class="property">@model</span>.set <span class="string">"text<span class="subst">#{@currentEditingPosition}</span>"</span>, value
        <span class="property">@model</span>.save()
        <span class="property">@parentView</span>.parentView.model.save()

        <span class="property">@render</span> <span class="property">@parentView</span>, <span class="property">@currentEditingPosition</span>

        <span class="property">@bindAllLabelsData</span>()

        <span class="property">@currentEditingPosition</span> = <span class="literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap for-h2">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <h2>TEXT SIZE AND ZOOM</h2>

            </div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>When user zooms in or out, check the current zoom level and resize
the labels accordingly. Fonts size will increase when zooming out,
but won&#39;t decrease when zooming in (zoom more than 1).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    onZoom: (e) =&gt;
        <span class="keyword">if</span> <span class="property">@parentView</span>.parentView.currentZoom &lt; <span class="number">1</span>
            <span class="keyword">return</span>

        <span class="property">@setAllFontSizes</span> e</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Set the foreground color ALL labels.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setAllForeground: (e) =&gt;
        <span class="property">@setForeground</span>(svg, <span class="property">@parentView</span>.foreground()) <span class="keyword">for</span> svg <span class="keyword">in</span> [<span class="property">@svgStart</span>, <span class="property">@svgMiddle</span>, <span class="property">@svgEnd</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>The the foreground color for the specified label.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setForeground: (svg, color) =&gt;
        <span class="keyword">if</span> <span class="keyword">not</span> svg?
            <span class="keyword">return</span>

        svg.attr {<span class="string">"fill"</span>: color}</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Set the font size for ALL labels.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setAllFontSizes: (e) =&gt;
        zoom = <span class="number">1</span>
        zoom = <span class="property">@parentView</span>.parentView.currentZoom <span class="keyword">if</span> <span class="property">@parentView</span>.parentView.currentZoom &gt; <span class="number">1</span>

        fontSize = <span class="property">@model</span>.fontSize() * zoom
        fontSize = Math.round fontSize

        <span class="property">@setFontSize</span>(svg, fontSize) <span class="keyword">for</span> svg <span class="keyword">in</span> [<span class="property">@svgStart</span>, <span class="property">@svgMiddle</span>, <span class="property">@svgEnd</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>The the font size for the specified label. Usually called when user is zooming
the map in or out.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    setFontSize: (svg, fontSize) =&gt;
        <span class="keyword">if</span> <span class="keyword">not</span> svg?
            <span class="keyword">return</span>

        svg.attr {<span class="string">"font-size"</span>: fontSize}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
